<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TUG - The Unseen Generation</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
     <!-- Desktop Navigation -->
  <div class="navigation">
    <!-- Hamburger Icon -->
    <div class="hamburger" onclick="toggleMenu()">â˜°</div>
    <a href="index.html"><img src="images/logo.png" alt="Unseen Generation Logo" height="60px" width="50px" loading="lazy"/></a>
    <nav class="desktop-nav">
      <div class="dropdown">
        <a href="#">About</a> <!-- Non-clickable -->
        <div class="dropdown-content">
          <a href="main.html">the UNSEEN generation</a>
          <a href="born.html">How It Was Born</a>
          <a href="mission.html">Mission</a>
          <a href="vision.html">Vision</a>
        </div>
      </div>
      <a href="causes.html">Causes</a>
      <a href="ef.html">Empowerment Fridays</a>
      <a href="seen&heard.html">Seen & Heard</a>
      <a href="TUG.html">TUG</a>
      <a href="gallery.html">Gallery</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
    <div class="container">
        <h1>The Unseen Generation (TUG)</h1>

        <!-- Post Form -->
        <div class="post-form">
            <input type="text" id="name" placeholder="Your Name">
            <input type="email" id="email" placeholder="Your Email (preferred)">
            <textarea id="message" rows="4" placeholder="Write something..."></textarea>
            <button id="postBtn">Post</button>
        </div>

        <!-- Posts Feed -->
        <div id="postsFeed"></div>
    </div>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyD8P_Cpg8oiGKWuefw8MDAGIGxuNwazlIY",
    authDomain: "theunseengeneration-ef3a7.firebaseapp.com",
    databaseURL: "https://theunseengeneration-ef3a7-default-rtdb.firebaseio.com",
    projectId: "theunseengeneration-ef3a7",
    storageBucket: "theunseengeneration-ef3a7.firebasestorage.app",
    messagingSenderId: "19836098555",
    appId: "1:19836098555:web:98632364991cfe7678dd5e"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>
    
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

// Firebase config (replace with yours if different)
const firebaseConfig = {
  apiKey: "AIzaSyD8P_Cpg8oiGKWuefw8MDAGIGxuNwazlIY",
  authDomain: "theunseengeneration-ef3a7.firebaseapp.com",
  databaseURL: "https://theunseengeneration-ef3a7-default-rtdb.firebaseio.com",
  projectId: "theunseengeneration-ef3a7",
  storageBucket: "theunseengeneration-ef3a7.firebasestorage.app",
  messagingSenderId: "19836098555",
  appId: "1:19836098555:web:98632364991cfe7678dd5e"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

// Admin password
const ADMIN_PASSWORD = "admin123";
let isAdmin = false;

// References
const postsRef = ref(database, 'posts');

// Elements
const postBtn = document.getElementById('postBtn');
const nameInput = document.getElementById('name');
const emailInput = document.getElementById('email');
const messageInput = document.getElementById('message');
const feed = document.getElementById('postsFeed');

// Store user email locally
emailInput.addEventListener('blur', () => {
  localStorage.setItem('userEmail', emailInput.value.trim());
});

// Post button
postBtn.addEventListener('click', () => {
  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const message = messageInput.value.trim();

  if(!name || !email || !message){
    alert("Please fill in all fields.");
    return;
  }

  const newPostRef = push(postsRef);
  set(newPostRef, {
    id: newPostRef.key,
    name,
    email,
    message,
    time: new Date().toLocaleString()
  });

  nameInput.value = '';
  emailInput.value = '';
  messageInput.value = '';
});

// Listen for posts in real-time
onValue(postsRef, (snapshot) => {
  const posts = snapshot.val();
  renderPosts(posts);
});

// Render posts
function renderPosts(posts) {
  feed.innerHTML = '';
  if(!posts) return;

  Object.values(posts).reverse().forEach(post => {
    const postDiv = document.createElement('div');
    postDiv.className = 'post';
    postDiv.dataset.id = post.id;

    // Menu options
    let menuHTML = '';
    if(post.email === localStorage.getItem('userEmail')){
      menuHTML = `
        <span class="menu" onclick="toggleMenu('${post.id}')">â‹®</span>
        <div id="menu-${post.id}" class="post-menu" style="display:none;">
          <div onclick="editPost('${post.id}')">Edit</div>
          <div onclick="deletePost('${post.id}')">Delete</div>
        </div>`;
    } else {
      menuHTML = `<span class="menu" onclick="reportPost('${post.id}')">â‹® Report</span>`;
    }

    if(isAdmin){
      menuHTML += ` <span style="cursor:pointer;color:red;" onclick="adminDelete('${post.id}')">[Delete as Admin]</span>`;
    }

    postDiv.innerHTML = `
      <div class="post-header" style="position:relative;">
        <strong>${post.name}</strong>
        ${menuHTML}
      </div>
      <p>${post.message}</p>
      <small>${post.time}</small>
      <div class="reactions">
        <span onclick="react('${post.id}','Motivating ðŸ’ª')">Motivating ðŸ’ª</span>
        <span onclick="react('${post.id}','Inspiring âœ¨')">Inspiring âœ¨</span>
        <span onclick="react('${post.id}','Relatable ðŸ’­')">Relatable ðŸ’­</span>
        <span onclick="react('${post.id}','I See You ðŸ‘€')">I See You ðŸ‘€</span>
      </div>
    `;
    feed.appendChild(postDiv);
  });
}

// Toggle menu
window.toggleMenu = function(id){
  const menu = document.getElementById(`menu-${id}`);
  if(menu.style.display === 'none') menu.style.display = 'block';
  else menu.style.display = 'none';
};

// Edit post
window.editPost = function(id){
  const newMessage = prompt("Edit your post:");
  if(!newMessage) return;

  const postRef = ref(database, `posts/${id}`);
  update(postRef, { message: newMessage });
};

// Delete your post
window.deletePost = function(id){
  if(!confirm("Are you sure you want to delete this post?")) return;
  const postRef = ref(database, `posts/${id}`);
  remove(postRef);
};

// Report post
window.reportPost = function(id){
  alert("This post has been reported. Thank you.");
};

// Admin delete
window.adminDelete = function(id){
  if(!isAdmin){
    const pw = prompt("Enter admin password:");
    if(pw !== ADMIN_PASSWORD){
      alert("Wrong password.");
      return;
    }
    isAdmin = true;
  }
  const postRef = ref(database, `posts/${id}`);
  remove(postRef);
};

// Reactions
window.react = function(id, reaction){
  alert(`You reacted: ${reaction}`);
};

// Close menus when clicking outside
document.addEventListener('click', function(event){
  const postsMenus = document.querySelectorAll('.post-menu');
  postsMenus.forEach(menu=>{
    if(!menu.contains(event.target) && event.target.className !== 'menu'){
      menu.style.display = 'none';
    }
  });
});
</script>

</body>
</html>
