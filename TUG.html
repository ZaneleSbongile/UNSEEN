<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TUG - The Unseen Generation</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Desktop Navigation -->
  <div class="navigation">
    <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
    <a href="index.html"><img src="images/logo.png" alt="Unseen Generation Logo" height="60" width="50" loading="lazy"/></a>
    <nav class="desktop-nav">
      <div class="dropdown">
        <a href="#">About</a>
        <div class="dropdown-content">
          <a href="main.html">the UNSEEN generation</a>
          <a href="born.html">How It Was Born</a>
          <a href="mission.html">Mission</a>
          <a href="vision.html">Vision</a>
        </div>
      </div>
      <a href="causes.html">Causes</a>
      <a href="ef.html">Empowerment Fridays</a>
      <a href="seen&heard.html">Seen & Heard</a>
      <a href="TUG.html">TUG</a>
      <a href="gallery.html">Gallery</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>

  <div class="container">
    <h1>The Unseen Generation (TUG)</h1>
    <p>
      Welcome to The Unseen Generation (TUG) Space ‚Äî a safe corner to share your story.
      Post freely, read, and connect with a community that understands that even the smallest
      acknowledgment can make a huge difference.
    </p>

    <!-- Post Form -->
    <div class="post-form" style="margin-top:16px;">
      <input type="text" id="name" placeholder="Your Name" />
      <input type="email" id="email" placeholder="Your Email (preferred)" />
      <textarea id="message" rows="4" placeholder="Write something..."></textarea>
      <button id="postBtn" type="button">Post</button>
      <button id="adminBtn" type="button" style="margin-top:8px; background:#000; color:#fff;">Admin</button>
    </div>

    <!-- Posts Feed -->
    <div id="postsFeed" style="margin-top:20px;"></div>
  </div>

  <footer id="site-footer">
    <p>&copy; 2025 The Unseen Generation. All rights reserved.</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD8P_Cpg8oiGKWuefw8MDAGIGxuNwazlIY",
      authDomain: "theunseengeneration-ef3a7.firebaseapp.com",
      databaseURL: "https://theunseengeneration-ef3a7-default-rtdb.firebaseio.com",
      projectId: "theunseengeneration-ef3a7",
      storageBucket: "theunseengeneration-ef3a7.firebasestorage.app",
      messagingSenderId: "19836098555",
      appId: "1:19836098555:web:98632364991cfe7678dd5e"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const postsRef = ref(database, 'posts');

    const postBtn = document.getElementById('postBtn');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const messageInput = document.getElementById('message');
    const feed = document.getElementById('postsFeed');
    const adminBtn = document.getElementById('adminBtn');

    emailInput.addEventListener('blur', () => {
      localStorage.setItem('userEmail', emailInput.value.trim());
    });

    let currentPosts = {};

    postBtn.addEventListener('click', () => {
      const name = nameInput.value.trim();
      const email = emailInput.value.trim();
      const message = messageInput.value.trim();

      if(!name || !email || !message){
        alert("Please fill in all fields.");
        return;
      }

      const newPostRef = push(postsRef);
      set(newPostRef, {
        id: newPostRef.key,
        name,
        email,
        message,
        time: new Date().toLocaleString()
      });

      nameInput.value = '';
      emailInput.value = '';
      messageInput.value = '';
    });

    // Redirect to admin.html
    adminBtn.addEventListener('click', () => {
      window.location.href = 'admin.html';
    });

    onValue(postsRef, snapshot => {
      currentPosts = snapshot.val() || {};
      renderPosts(currentPosts);
    });

    function renderPosts(posts){
      feed.innerHTML = '';
      Object.values(posts).reverse().forEach(post => {
        const postDiv = document.createElement('div');
        postDiv.className = 'post';
        postDiv.dataset.id = post.id;
        const ownerEmail = localStorage.getItem('userEmail');
        let menuHTML = `<span class="menu" onclick="reportPost('${post.id}')">‚ãÆ Report</span>`;
        postDiv.innerHTML = `
          <div class="post-header" style="position:relative;">
            <strong>${escapeHtml(post.name)}</strong>
            ${menuHTML}
          </div>
          <p>${escapeHtml(post.message)}</p>
          <small>${escapeHtml(post.time)}</small>
        `;
        feed.appendChild(postDiv);
      });
    }

    function escapeHtml(unsafe) {
      if(!unsafe && unsafe !== '') return '';
      return String(unsafe)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#039;');
    }

    // Toggle side menu
    window.toggleMenu = function(){
      const menu = document.getElementById("sideMenu");
      if(menu) menu.classList.toggle('active');
    };

  </script>

  <div class="side-menu" id="sideMenu">
    <a href="index.html">üè† Home</a>
    <a href="about.html">About</a>
    <a href="causes.html">Causes</a>
    <a href="ef.html">Empowerment Fridays</a>
    <a href="seen&heard.html">Seen & Heard</a>
    <a href="TUG.html">TUG</a>
    <a href="gallery.html">Gallery</a>
    <a href="contact.html">Contact</a>
  </div>
</body>
</html>
